This is called in run functions